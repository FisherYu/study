var lz77={winSize:1024,maxMatches:63,minMatches:3,encode:function(h,e){function r(h,e){for(var r=0,t=0;t<lz77.minMatches;t++)r=131*r+h[e+t];return r}function t(h){if(n.b.push(h),n.b.length>lz77.winSize&&(n.b.shift(),delete n.hh[n.h.shift()]),n.b.length>=lz77.minMatches){var e=n.b.length-lz77.minMatches;
n.hh[n.h[e]=r(n.b,e)]=e}}e=e||{};for(var n={b:[],h:[],hh:{}},l=[],a=0;a<h.length;a++)l.push(h.charCodeAt(a));for(var i,s,c,o=0,f=-1,u=[];o<l.length;){if(o<l.length-lz77.minMatches+1){var v=r(l,o);if(s=0,c=0,n.hh.hasOwnProperty(v)){for(var a,z,g=n.hh[v],a=g,z=o;a<n.b.length&&z<l.length&&!(n.b[a]!=l[z]||z-o>=lz77.maxMatches);a++,z++);a-g>=c&&a-g>=lz77.minMatches&&(c=a-g,s=g)
}if(c){o+=c,f=-1,u.push(c);var i=n.b.length-(s+c);if(127>=i)u.push(i);else{for(var p=[];i>0;)p.push(127&i),i>>=7;for(var a=p.length-1;a>=0;a--)u.push(128|p[a]);u[u.length-1]&=127}continue}t(l[o])}(-1==f||255==u[f])&&(u.push(128),f=u.length-1),u.push(l[o++]),u[f]++}return e.charCodeArray?u:cwx.util.cc2str(u)
},decode:function(h,e){e=e||{};var r;if(e.charCodeArray)r=h;else{r=[];for(var t=0;t<h.length;t++)r.push(h.charCodeAt(t))}for(var n,l,a=[],i=0,s=0,c=0,o=[],f=0;f<r.length;f++)if(n=r[f],128&n)for(var u=127&n,t=0;u>t;t++)l=r[++f],a[i++%lz77.winSize]=l,o.push(l);else{var v,z=0;do v=r[++f],z=z<<7|127&v;while(128&v);
for(s=i-n-z,c=i-z;c>s;)o.push(a[s++%lz77.winSize])}return cwx.util.cc2str(o)}};module.exports=lz77;